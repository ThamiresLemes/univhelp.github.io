{"version":3,"sources":["blocks/manager.min.js"],"names":["$","window","document","undefined","editorVal","inactiveBlockClass","editing","updated","dialogEditOpened","blockPositions","emptyPositionsObj","template","origin","inlineForm","dialogConfirm","dialogEdit","dialogCopy","cButtons","dButtons","eButtons","lButtons","blockObj","blockData","editable","block","body","msgObj","saveBtn","lang","config","actions","editMode","phpbb","tinymce","Twig","getPOJO","arrayOfObjects","data","each","this","name","push","value","fixPaths","subject","replace","RegExp","match","g1","webRootPath","removeGrid","items","removeClass","matches","className","join","sortHorizontal","numItems","length","numCols","parent","itemsLeft","divisibleItems","hasClass","i","slice","addClass","n","showAllPositions","siblings","trigger","hideEmptyPositions","last","makeEditable","element","text","show","appendTo","children","val","focus","select","end","undoEditable","v","hide","renderBlock","id","editor","get","EditorManager","remove","content","html","render","find","execCommand","indexOf","eval","saveLayout","blocks","weight","pos","attr","bid","substring","position","post","save_blocks","route","button","addBlock","posID","blockName","droppedElement","removeAttr","ajaxLoading","trim","index","ext","getJSON","add_block","result","not","percent","getEditForm","edit_block","resp","form","tabs","$this","change","toggleSelectSettings","dialog","buttons","edit","title","getCustomClasses","saveForm","serializeArray","updateSimilar","extend","similar","class","encodeURI","save_block","list","row","updateBlock","update_block","customBlockAction","handle_custom_action","rawHTML","setContent","placeholder","setDefaultLayout","set","set_default_route","setStartPage","info","set_startpage","param","setRoutePrefs","exPositions","set_route_prefs","hidePositions","copyBlocks","copyFrom","copy_route","empty","append","processInput","e","parentsUntil","field","previewBlock","formData","cssClass","undoPreviewBlock","initTinyMce","options","selector","inline","image_advtab","hidden_input","noneditable_noneditable_class","plugins","toolbar","automatic_uploads","images_reuse_filename","images_upload_base_path","images_upload_url","uploadUrl","valid_elements","end_container_on_empty_block","setup","blockIsInactive","blockRawHTML","on","getContent","blockId","activeEditor","uploadImages","rawEditorContent","format","editorContent","filemanager","rfmPath","scriptPath","external_filemanager_path","external_plugins","filemanager_access_key","RFAccessKey","filemanager_title","fileManager","init","showMessage","message","fadeIn","delay","fadeOut","positions","showCurrentState","hidingBlocks","hidingPos","ready","boardUrl","style","blocksPanel","overPosition","isHidingBlocks","loader","click","toggleClass","prev","toggle","twig","draggable","addClasses","iframeFix","opacity","helper","revert","connectToSortable","start","event","ui","sortable","stop","setTimeout","sortableOptions","connectWith","cancel","tolerance","cursor","cursorAt","top","left","item","over","out","isEmptyObject","update","stopPropagation","preventDefault","editorId","blur","disabled","next","exPos","styleSelector","ajaxSetup","beforeSend","xhr","settings","url","complete","responseJSON","error","ajaxError","horizontalPos","defDialog","autoOpen","modal","width","deleteAll","dialogDeleteAll","copy","fromRoute","fromStyle","layoutAction","location","href","open","pane","prependTo","beforeClose","action","target","slideToggle","obj","animate","scrollTop","setDefault","controller","method","params","submit","is","onbeforeunload","returnValue","leaveConfirm","iconPicker","onSelect","iconClass","icon","jQuery"],"mappings":"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","file":"manager.min.js","sourcesContent":[";(function($, window, document, undefined) {\n\t'use strict';\n\n\tvar editorVal = '';\n\tvar inactiveBlockClass = 'sm-inactive';\n\tvar editing = false;\n\tvar updated = false;\n\tvar dialogEditOpened = false;\n\tvar blockPositions = {};\n\tvar emptyPositionsObj = {};\n\tvar template = {};\n\tvar origin = {};\n\tvar inlineForm = {};\n\tvar dialogConfirm = {};\n\tvar dialogEdit = {};\n\tvar dialogCopy = {};\n\tvar cButtons = {};\n\tvar dButtons = {};\n\tvar eButtons = {};\n\tvar lButtons = {};\n\tvar blockObj = {};\n\tvar blockData = {\n\t\teditable: ' editable',\n\t\tblock: {}\n\t};\n\tvar body = {};\n\tvar msgObj = {};\n\tvar saveBtn = {};\n\n\t// These variables are defined in template file\n\tvar lang = {};\n\tvar config = {};\n\tvar actions = {};\n\tvar editMode = false;\n\n\t// These objects are provided by third-party scripts\n\tvar phpbb = {};\n\tvar tinymce = {};\n\tvar Twig = {};\n\n\tvar getPOJO = function(arrayOfObjects) {\n\t\tvar data = {};\n\n\t\t$.each(arrayOfObjects, function() {\n\t\t\tif (data[this.name]) {\n\t\t\t\tif (!data[this.name].push) {\n\t\t\t\t\tdata[this.name] = [data[this.name]];\n\t\t\t\t}\n\t\t\t\tdata[this.name].push(this.value || '');\n\t\t\t} else {\n\t\t\t\tdata[this.name] = this.value || '';\n\t\t\t}\n\t\t});\n\n\t\treturn data;\n\t};\n\n\tvar fixPaths = function(subject) {\n\t\treturn subject.replace(new RegExp('(?:href|src)=(?:\"|\\')((?:.\\/)?(?:\\.\\.\\/)+)(?:.*?)(?:\"|\\')', 'gmi'), function(match, g1) {\n\t\t\treturn match.replace(g1, config.webRootPath);\n\t\t});\n\t};\n\n\tvar removeGrid = function(items) {\n\t\titems.removeClass(function() {\n\t\t\tvar matches = this.className.match(/grid__col+(\\S+)?/gi);\n\t\t\treturn (matches) ? matches.join(' ') : '';\n\t\t});\n\t};\n\n\tvar sortHorizontal = function(items) {\n\t\tvar numItems = items.length;\n\t\tvar numCols = (items.parent().data('columns') !== undefined) ? ((items.parent().data('columns') <= 5) ? items.parent().data('columns') : 5) : 3;\n\t\tvar itemsLeft = numItems % numCols;\n\t\tvar divisibleItems = numItems - itemsLeft;\n\n\t\tif (numItems <= numCols) {\n\t\t\tnumCols = numItems;\n\t\t} else if (items.parent().hasClass('equal')) {\n\t\t\tif (itemsLeft > 0 && numCols > 3) {\n\t\t\t\tfor (var i = 1; i < itemsLeft; i++) {\n\t\t\t\t\tif (numItems % (numCols - i) === 0) {\n\t\t\t\t\t\tnumCols = numCols - i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tdivisibleItems = numItems;\n\t\t\titemsLeft = 0;\n\t\t}\n\n\t\tremoveGrid(items);\n\n\t\tif (divisibleItems > 0) {\n\t\t\titems.slice(0, divisibleItems).addClass('grid__col grid__col--1-of-' + numCols + ' grid__col--m-1-of-' + numCols);\n\t\t}\n\n\t\tif (itemsLeft) {\n\t\t\tvar n = 1;\n\t\t\tif (itemsLeft < 2) {\n\t\t\t\tn = 5;\n\t\t\t\titemsLeft = 5;\n\t\t\t}\n\t\t\titems.slice(divisibleItems, numItems)\n\t\t\t\t.addClass('grid__col grid__col--' + n + '-of-' + itemsLeft + ' grid__col--m-' + n + '-of-' + itemsLeft);\n\t\t}\n\t};\n\n\tvar showAllPositions = function() {\n\t\tblockPositions.addClass('show-position');\n\t\temptyPositionsObj.removeClass('empty-position').siblings('.grid__col').removeClass('lastUnit');\n\n\t\t/**\n\t\t * Event to allow other extensions to do something when all block positions are shown\n\t\t *\n\t\t * @event blitze_sitemaker_showAllBlockPositions\n\t\t * @type {object}\n\t\t * @property {object} blockPositions jQuery object representing all block positions\n\t\t * @property {object} emptyPositionsObj jQuery object representing all block positions with no blocks\n\t\t */\n\t\tbody.trigger('blitze_sitemaker_showAllBlockPositions', [blockPositions, emptyPositionsObj]);\n\t};\n\n\tvar hideEmptyPositions = function() {\n\t\tblockPositions.removeClass('show-position');\n\t\temptyPositionsObj = $('.block-position:not(:has(\".block\"))').addClass('empty-position').each(function() {\n\t\t\t$(this).siblings('.grid__col').last().addClass('lastUnit');\n\t\t});\n\n\t\t/**\n\t\t * Event to allow other extensions to do something when empty positions are hidden\n\t\t *\n\t\t * @event blitze_sitemaker_hideEmptyBlockPositions\n\t\t * @type {object}\n\t\t * @property {object} blockPositions jQuery object representing all block positions\n\t\t * @property {object} emptyPositionsObj jQuery object representing all block positions with no blocks\n\t\t */\n\t\tbody.trigger('blitze_sitemaker_hideEmptyBlockPositions', [blockPositions, emptyPositionsObj]);\n\t};\n\n\tvar makeEditable = function(element) {\n\t\tif (editing === true) {\n\t\t\tinlineForm.children(':input').trigger('blur');\n\t\t\treturn;\n\t\t}\n\t\tediting = true;\n\t\teditorVal = element.removeClass('editable').text();\n\t\tinlineForm.show().appendTo(element.text('')).children(':input').val(editorVal).focus().select().end();\n\t};\n\n\tvar undoEditable = function(v) {\n\t\tvar element = inlineForm.parent();\n\n\t\tediting = false;\n\t\teditorVal = '';\n\t\telement.addClass('editable').text(v);\n\t\tinlineForm.hide().appendTo($('body'));\n\t};\n\n\tvar renderBlock = function(blockObj, blockData) {\n\t\t// if tinymce editor instance already exists, remove it\n\t\tvar id = 'block-editor-' + blockData.block.id;\n\t\tvar editor = tinymce.get(id);\n\t\tif (editor) {\n\t\t\ttinymce.EditorManager.remove(editor);\n\t\t}\n\n\t\tblockData.block.content = fixPaths(blockData.block.content);\n\n\t\t/**\n\t\t * Event to allow other extensions to manange how block is rendered\n\t\t * setting $(this).data('renderBlock', false) in the listener will prevent a render here\n\t\t *\n\t\t * @event blitze_sitemaker_renderBlock_before\n\t\t * @type {object}\n\t\t * @property {array} block Block data to display (id, name, icon, etc)\n\t\t * @property {object} blockObj Jquery object representing the block element being rendered\n\t\t */\n\t\tif (body.trigger('blitze_sitemaker_renderBlock_before', [blockData.block, blockObj]).data('renderBlock') !== false) {\n\t\t\tblockObj.html(template.render(blockData));\n\t\t}\n\n\t\t// if custom block, add editor\n\t\tif (blockData.block.name === \"blitze.sitemaker.block.custom\") {\n\t\t\tif (blockObj.find('#' + id).length) {\n\t\t\t\ttinymce.EditorManager.execCommand('mceAddEditor', false, id);\n\t\t\t} else if (blockData.block.content.indexOf('script') > -1) {\n\t\t\t\teval(blockObj.find('.sm-block-content').html());\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Event to allow other extensions to do something after block is rendered\n\t\t *\n\t\t * @event blitze_sitemaker_renderBlock_after\n\t\t * @type {object}\n\t\t * @property {array} block Block data to display (id, name, icon, etc)\n\t\t * @property {object} blockObj Jquery object representing the block element being rendered\n\t\t */\n\t\tbody.trigger('blitze_sitemaker_renderBlock_after', [blockData.block, blockObj]);\n\t};\n\n\tvar saveLayout = function() {\n\t\tvar blocks = {};\n\t\t$('.block-position').each(function() {\n\t\t\tvar weight = 0;\n\t\t\tvar pos = $(this).attr('id');\n\t\t\t$(this).find('.block').each(function() {\n\t\t\t\tvar id = $(this).attr('id');\n\t\t\t\tif (pos !== undefined && id !== undefined) {\n\t\t\t\t\tvar bid = id.substring(6);\n\t\t\t\t\tblocks[bid] = {\n\t\t\t\t\t\t'position': pos.substring(4),\n\t\t\t\t\t\t'weight': weight\n\t\t\t\t\t};\n\t\t\t\t\tweight++;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$.post(actions.save_blocks, {route: config.route, blocks: blocks}, function() {\n\t\t\tsaveBtn.button('disable');\n\t\t\tupdated = false;\n\t\t});\n\t};\n\n\tvar addBlock = function(posID, blockName, droppedElement) {\n\t\t$(droppedElement).removeAttr('role aria-disabled data-block class style')\n\t\t\t.addClass('block')\n\t\t\t.html('<div class=\"ui-state-highlight sm-block-spacing sortable\" style=\"padding: 5px\"><i class=\"fa fa-spinner fa-2x fa-spin\"></i> ' + lang.ajaxLoading + '</div>');\n\n\t\tvar data = {\n\t\t\tblock: $.trim(blockName),\n\t\t\tweight: droppedElement.parent().find('.block').index(droppedElement),\n\t\t\troute: config.route,\n\t\t\text: config.ext,\n\t\t\tposition: posID\n\t\t};\n\n\t\t$.getJSON(actions.add_block, data, function(result) {\n\t\t\tupdated = false;\n\t\t\tif (result.id === '') {\n\t\t\t\t$(droppedElement).remove();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar blockObj = $(droppedElement).attr('id', 'block-' + result.id);\n\n\t\t\trenderBlock(blockObj, { block: result });\n\n\t\t\tblockObj.children().not('.block-controls')\n\t\t\t\t.show('scale', {percent: 100}, 1000);\n\n\t\t\tif (updated) {\n\t\t\t\tsaveLayout();\n\t\t\t}\n\t\t});\n\t};\n\n\tvar getEditForm = function(block) {\n\t\t$.getJSON(actions.edit_block, {id: block.attr('id').substring(6)}, function(resp) {\n\t\t\tblockData.block = resp;\n\t\t\tif (resp.form) {\n\t\t\t\tdialogEdit.html(resp.form);\n\t\t\t\tdialogEdit.find('#block-settings').tabs();\n\t\t\t\tdialogEdit.find('select[data-togglable-settings]').each(function() {\n\t\t\t\t\tvar $this = $(this);\n\n\t\t\t\t\t$this.change(function() {\n\t\t\t\t\t\tphpbb.toggleSelectSettings($this);\n\t\t\t\t\t});\n\t\t\t\t\tphpbb.toggleSelectSettings($this);\n\t\t\t\t});\n\t\t\t\tdialogEdit.dialog({buttons: eButtons}).dialog('option', 'title', lang.edit + ' - ' + resp.title.replace(/(<([^>]+)>)/ig,\"\")).dialog('open');\n\t\t\t}\n\t\t});\n\t};\n\n\tvar getCustomClasses = function() {\n\t\treturn dialogEdit.find('#block_class').text().trim();\n\t};\n\n\tvar saveForm = function(block) {\n\t\tvar data = getPOJO($('#edit_form').serializeArray());\n\t\tvar updateSimilar = dialogEdit.dialog('widget').find('#update-similar:checked').length;\n\n\t\t$.extend(data, {\n\t\t\t'id': block.attr('id').substring(6),\n\t\t\t'route': config.route,\n\t\t\t'similar': updateSimilar,\n\t\t\t'class': getCustomClasses()\n\t\t});\n\n\t\tif (data['config[source]']) {\n\t\t\tdata['config[source]'] = encodeURI(data['config[source]']);\n\t\t}\n\n\t\tdialogEdit.dialog('close');\n\n\t\t$.post(actions.save_block, data, function(resp) {\n\t\t\tif (resp.list) {\n\t\t\t\t$.each(resp.list, function(i, row) {\n\t\t\t\t\trenderBlock($('#block-' + row.id), { block: row });\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\tvar updateBlock = function(data) {\n\t\tif (data.id === undefined) {\n\t\t\treturn false;\n\t\t}\n\n\t\tdata.route = config.route;\n\t\t$.post(actions.update_block, data, function(resp) {\n\t\t\tif (editing === true) {\n\t\t\t\tundoEditable(resp.title);\n\t\t\t}\n\t\t}, 'json');\n\t};\n\n\tvar customBlockAction = function(data) {\n\t\tif (data.id === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\t$.post(actions.handle_custom_action, data, function(resp) {\n\t\t\tif (resp.id) {\n\t\t\t\tvar id = 'block-editor-' + resp.id;\n\t\t\t\tvar rawHTML = fixPaths(resp.content);\n\t\t\t\tvar block = $('#block-' + resp.id + ' > .sm-block-container');\n\t\t\t\tvar editor = $('#' + id).attr('data-raw', rawHTML);\n\n\t\t\t\ttinymce.get(id).setContent(rawHTML ? rawHTML : lang.placeholder);\n\n\t\t\t\tif (!resp.content || !editor.data('active')) {\n\t\t\t\t\tblock.addClass(inactiveBlockClass);\n\t\t\t\t} else  {\n\t\t\t\t\tblock.removeClass(inactiveBlockClass);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\tvar setDefaultLayout = function(set) {\n\t\t$.post(actions.set_default_route, { route: (set === true) ? config.route : '' });\n\t};\n\n\tvar setStartPage = function(info) {\n\t\t$.post(actions.set_startpage, $.param(info));\n\t};\n\n\tvar setRoutePrefs = function(form, exPositions) {\n\t\tvar data = $.extend(getPOJO(form.serializeArray()), {\n\t\t\troute: config.route,\n\t\t\text: config.ext\n\t\t});\n\t\t$.post(actions.set_route_prefs, data, function() {\n\t\t\tblockPositions.removeClass(inactiveBlockClass);\n\t\t\tif (exPositions) {\n\t\t\t\thidePositions(exPositions);\n\t\t\t}\n\t\t});\n\t};\n\n\tvar copyBlocks = function(copyFrom) {\n\t\tvar position = $('.block-position');\n\t\tvar data = $.extend(getPOJO(copyFrom), {\n\t\t\troute: config.route,\n\t\t\text: config.ext\n\t\t});\n\n\t\t$.getJSON(actions.copy_route, data, function(resp) {\n\t\t\tif (!resp.list || resp.list.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tshowAllPositions();\n\t\t\tposition.empty();\n\n\t\t\t$.each(resp.list, function(position, blocks) {\n\t\t\t\tvar pos = $('#pos-' + position);\n\t\t\t\t$.each(blocks, function(i, row) {\n\t\t\t\t\tblockData.block = row;\n\t\t\t\t\tpos.append('<div id=\"block-' + row.id + '\" class=\"unit size1of1 block\"></div>');\n\t\t\t\t\trenderBlock(pos.find('#block-' + row.id), blockData);\n\t\t\t\t});\n\n\t\t\t\tif (pos.hasClass('horizontal')) {\n\t\t\t\t\tsortHorizontal(pos.find('.block'));\n\t\t\t\t}\n\t\t\t});\n\t\t\thideEmptyPositions();\n\t\t});\n\t};\n\n\tvar processInput = function(e) {\n\t\tif (editing === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar id = $(e).parentsUntil('.block').parent().attr('id').substring(6);\n\t\tvar title = $(e).val();\n\n\t\tif (id && title !== editorVal) {\n\t\t\tupdateBlock({'id': id, 'field': 'title', 'title': title});\n\t\t} else {\n\t\t\tundoEditable(editorVal);\n\t\t}\n\t\treturn false;\n\t};\n\n\tvar previewBlock = function() {\n\t\t// make a copy of block data\n\t\tvar data = $.extend(true, {}, blockData);\n\t\tvar formData = dialogEdit.find('#edit_form').serializeArray();\n\t\tvar cssClass = getCustomClasses();\n\n\t\t$.each(formData, function() {\n\t\t\tdata.block[this.name] = (typeof data.block[this.name] === 'boolean') ? ((this.value === '1') ? true : false) : this.value;\n\t\t});\n\n\t\tdata.block['class'] = (cssClass) ? ' ' + cssClass : '';\n\n\t\trenderBlock(blockObj, data);\n\t};\n\n\tvar undoPreviewBlock = function() {\n\t\trenderBlock(blockObj, blockData);\n\t};\n\n\tvar initTinyMce = function() {\n\t\tvar options = {\n\t\t\t'selector': 'div.editable-block',\n\t\t\t'inline': true,\n\t\t\t'image_advtab': true,\n\t\t\t'hidden_input': false,\n\t\t\t'noneditable_noneditable_class': 'fa',\n\t\t\t'plugins': [\n\t\t\t\t'advlist autolink lists link image imagetools charmap preview hr anchor pagebreak',\n\t\t\t\t'visualblocks visualchars code media nonbreaking save table contextmenu directionality',\n\t\t\t\t'paste textcolor colorpicker textpattern fontawesome noneditable'\n\t\t\t],\n\t\t\t'toolbar': [\n\t\t\t\t'undo redo | styleselect | fontsizeselect | bold italic | forecolor backcolor | alignleft aligncenter alignright alignjustify',\n\t\t\t\t'responsivefilemanager image media | fontawesome | bullist numlist outdent indent | hr pagebreak | link | table | removeformat code'\n\t\t\t],\n\t\t\t'automatic_uploads': true,\n\t\t\t'images_reuse_filename': true,\n\t\t\t'images_upload_base_path': config.webRootPath + 'images/sitemaker_uploads/source/',\n\t\t\t'images_upload_url': config.uploadUrl,\n\t\t\t'valid_elements': '*[*]',\n\t\t\t'end_container_on_empty_block': true,\n\t\t\t'setup': function(editor) {\n\t\t\t\tvar blockObj = {};\n\t\t\t\tvar blockIsInactive = true;\n\t\t\t\tvar blockRawHTML = '';\n\n\t\t\t\teditor.on('init', function() {\n\t\t\t\t\tif (editor.getContent().length === 0) {\n\t\t\t\t\t\teditor.setContent(lang.placeholder);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\teditor.on('focus', function() {\n\t\t\t\t\tvar blockId = editor.id.substring(13);\n\t\t\t\t\tblockObj = $('#block-' + blockId + ' > .sm-block-container');\n\t\t\t\t\tblockIsInactive = blockObj.hasClass(inactiveBlockClass);\n\t\t\t\t\tblockRawHTML = $('#' + editor.id).data('raw');\n\t\t\t\t\teditor.setContent(blockRawHTML);\n\t\t\t\t});\n\n\t\t\t\teditor.on('keyUp', function() {\n\t\t\t\t\tif (blockIsInactive && editor.getContent().length) {\n\t\t\t\t\t\tblockIsInactive = false;\n\t\t\t\t\t\tblockObj.removeClass(inactiveBlockClass);\n\t\t\t\t\t} else if (!blockIsInactive && !editor.getContent().length) {\n\t\t\t\t\t\tblockIsInactive = true;\n\t\t\t\t\t\tblockObj.addClass(inactiveBlockClass);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\teditor.on('blur', function() {\n\t\t\t\t\ttinymce.activeEditor.uploadImages(function() {\n\t\t\t\t\t\tvar rawEditorContent = editor.getContent({format: 'raw'}).replace('<p><br data-mce-bogus=\"1\"></p>', '');\n\t\t\t\t\t\tvar editorContent = editor.getContent();\n\n\t\t\t\t\t\tif (rawEditorContent !== blockRawHTML && rawEditorContent !== lang.placeholder) {\n\t\t\t\t\t\t\tif (!editorContent.length) {\n\t\t\t\t\t\t\t\trawEditorContent = '';\n\t\t\t\t\t\t\t\teditor.setContent(lang.placeholder);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar blockData = $('#' + editor.id).data('raw', rawEditorContent).data();\n\t\t\t\t\t\t\tblockData.id = editor.id.substring(13);\n\t\t\t\t\t\t\tblockData.content = rawEditorContent;\n\n\t\t\t\t\t\t\tcustomBlockAction(blockData);\n\t\t\t\t\t\t} else if (!editorContent) {\n\t\t\t\t\t\t\teditor.setContent(lang.placeholder);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tif (config.filemanager) {\n\t\t\toptions.plugins.push('responsivefilemanager');\n\n\t\t\tvar rfmPath = config.scriptPath + 'ResponsiveFilemanager/filemanager/';\n\t\t\t$.extend(true, options, {\n\t\t\t\t'external_filemanager_path': rfmPath,\n\t\t\t\t'external_plugins': {\n\t\t\t\t\t\"filemanager\" : rfmPath + 'plugin.min.js'\n\t\t\t\t},\n\t\t\t\t'filemanager_access_key': config.RFAccessKey,\n\t\t\t\t'filemanager_title': lang.fileManager\n\t\t\t});\n\t\t}\n\t\ttinymce.init(options);\n\t};\n\n\tvar showMessage = function(message) {\n\t\tif (message) {\n\t\t\tmsgObj.html(message);\n\t\t\tmsgObj.fadeIn().delay(3000).fadeOut();\n\t\t}\n\t};\n\n\tvar hidePositions = function(positions) {\n\t\t$.each(positions, function(i, name) {\n\t\t\t$('#pos-' + name).addClass(inactiveBlockClass);\n\t\t});\n\t};\n\n\tvar showCurrentState = function(hidingBlocks, positions) {\n\t\tif (hidingBlocks) {\n\t\t\tshowMessage('<span><i class=\"fa fa-info-circle fa-blue fa-lg\"></i> ' + lang.hidingBlocks + '</span>');\n\t\t} else if (positions.length) {\n\t\t\tshowMessage('<span><i class=\"fa fa-info-circle fa-blue fa-lg\"></i> ' + lang.hidingPos + ': <strong>' + positions.join(', ') + '</strong></span>');\n\t\t\thidePositions(positions);\n\t\t}\n\t};\n\n\t$(document).ready(function() {\n\t\teditMode = window.editMode || false;\n\t\tlang = window.lang || {};\n\t\tphpbb = window.phpbb || {};\n\t\ttinymce = window.tinymce || {};\n\t\tTwig = window.Twig || {};\n\t\tactions = window.actions || {};\n\t\tconfig = window.config || {\n\t\t\tboardUrl: '',\n\t\t\troute: '',\n\t\t\text: '',\n\t\t\tstyle: '',\n\t\t\tuploadUrl: ''\n\t\t};\n\n\t\tvar copyFrom = '';\n\t\tvar blocksPanel = {};\n\t\tvar exPositions = {};\n\t\tvar overPosition = {};\n\t\tvar isHidingBlocks = false;\n\n\t\tvar loader = $('#admin-bar').show().find('#admin-control').click(function() {\n\t\t\tif (editMode) {\n\t\t\t\t$(this).toggleClass('admin-bar-toggler').prev().toggle();\n\t\t\t\tbody.toggleClass('push-down');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}).find('i');\n\n\t\tif (editMode) {\n\t\t\tinlineForm = $('<form class=\"inline-form\"><input type=\"text\" class=\"inline-edit\" value=\"\" /></form>').hide().appendTo($('body'));\n\n\t\t\tmsgObj = $('#ajax-message');\n\t\t\temptyPositionsObj = $('.block-position:not(:has(\".block\"))').addClass('empty-position');\n\n\t\t\ttemplate = Twig.twig({\n\t\t\t\tdata: $.trim($('#block-template-container').html())\n\t\t\t});\n\n\t\t\t$('#add-block-panel').find('.sitemaker-block').draggable({\n\t\t\t\taddClasses: false,\n\t\t\t\tiframeFix: true,\n\t\t\t\topacity: 0.7,\n\t\t\t\thelper: 'clone',\n\t\t\t\tappendTo: 'body',\n\t\t\t\trevert: 'invalid',\n\t\t\t\tconnectToSortable: '.block-position',\n\t\t\t\tstart: function(event, ui) {\n\t\t\t\t\t$(ui.helper).addClass('dragging');\n\t\t\t\t\tshowAllPositions();\n\t\t\t\t\tblockPositions.sortable('refresh');\n\t\t\t\t\tblocksPanel.trigger('click');\n\t\t\t\t},\n\t\t\t\tstop: function() {\n\t\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t\tif (updated === false) {\n\t\t\t\t\t\t\thideEmptyPositions();\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 600);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\texPositions = $('#ex_positions');\n\t\t\tvar sortableOptions = {\n\t\t\t\trevert: true,\n\t\t\t\tplaceholder: 'ui-state-highlight grid__col sm-block-spacing block sortable placeholder',\n\t\t\t\tconnectWith: '.block-position',\n\t\t\t\tcancel: '.editable-block, .inline-edit',\n\t\t\t\titems: '.block',\n\t\t\t\ttolerance: 'pointer',\n\t\t\t\tcursor: 'move',\n\t\t\t\tcursorAt: {\n\t\t\t\t\ttop: -10,\n\t\t\t\t\tleft: -10\n\t\t\t\t},\n\t\t\t\tstart: function(event, ui) {\n\t\t\t\t\torigin = $(ui.item).addClass('dragging').parent('.horizontal');\n\t\t\t\t\tshowAllPositions();\n\t\t\t\t\t$('.block-position').sortable('refresh');\n\t\t\t\t},\n\t\t\t\tover: function(event, ui) {\n\t\t\t\t\toverPosition = ui.placeholder.parent('.horizontal').children('.block').addClass('sortable');\n\t\t\t\t},\n\t\t\t\tout: function() {\n\t\t\t\t\tif ($.isEmptyObject(overPosition) === false) {\n\t\t\t\t\t\toverPosition.removeClass('sortable');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tupdate: function(event, ui) {\n\t\t\t\t\tupdated = true;\n\t\t\t\t\tif ($(ui.item).attr('id') === undefined) {\n\t\t\t\t\t\tvar posID = $(this).attr('id').substring(4);\n\t\t\t\t\t\tvar blockName = $(ui.item).attr('data-block');\n\t\t\t\t\t\tvar replace = $(this).find('div[data-block=\"' + blockName + '\"]');\n\t\t\t\t\t\taddBlock(posID, blockName, replace);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsaveBtn.button('enable');\n\t\t\t\t\t}\n\n\t\t\t\t\tvar items = $(ui.item).removeAttr('style').parent('.horizontal').children('.block');\n\t\t\t\t\tvar item = $(ui.item);\n\n\t\t\t\t\titem.parent().removeClass('empty-position');\n\t\t\t\t\tremoveGrid(item);\n\n\t\t\t\t\tif (items.length > 0) {\n\t\t\t\t\t\tsortHorizontal(items);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (origin.attr('id') !== $(ui.item).parent('.horizontal').attr('id')) {\n\t\t\t\t\t\tsortHorizontal(origin.find('.block').removeClass('sortable'));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstop: function(event, ui) {\n\t\t\t\t\t$(ui.item).removeClass('dragging sortable').removeAttr('style');\n\t\t\t\t\thideEmptyPositions();\n\n\t\t\t\t\t/**\n\t\t\t\t\t * Event to allow other extensions to do something when layout changes\n\t\t\t\t\t *\n\t\t\t\t\t * @event blitze_sitemaker_layout_changed\n\t\t\t\t\t * @type {object}\n\t\t\t\t\t */\n\t\t\t\t\tbody.trigger('blitze_sitemaker_layout_changed');\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tblockPositions = $('.block-position').addClass('block-receiver').sortable(sortableOptions).on('click', '.block-title', function(e) {\n\t\t\t\te.stopPropagation();\n\t\t\t\tmakeEditable($(this));\n\t\t\t}).on('submit', '.inline-form', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\t$(this).find('.inline-edit').trigger('blur');\n\t\t\t}).on('focusout', '.inline-edit', function() {\n\t\t\t\tprocessInput($(this));\n\t\t\t}).on('click', '.edit-block', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tblockObj = $(this).parentsUntil('.block').parent();\n\t\t\t\tgetEditForm(blockObj);\n\t\t\t}).on('click', '.delete-block', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tblockObj = $(this).parentsUntil('.block').parent();\n\t\t\t\tdialogConfirm.dialog({buttons: dButtons}).dialog('open');\n\t\t\t}).on('click', '.editable-block', function() {\n\t\t\t\tvar editorId = $(this).attr('id');\n\t\t\t\tif (!tinymce.get(editorId)) {\n\t\t\t\t\ttinymce.EditorManager.execCommand('mceAddEditor', false, editorId);\n\t\t\t\t\t$(this).blur();\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\ttinymce.get(editorId).focus();\n\t\t\t\t\t}, 300);\n\t\t\t\t}\n\t\t\t}).each(function() {\n\t\t\t\tvar pos = $(this).attr('id').substring(4);\n\t\t\t\tif (exPositions.find('option[value=' + pos + ']').length === 0) {\n\t\t\t\t\texPositions.append('<option value=\"' + pos + '\">' + pos + '</option>');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$('body').on('blitze_sitemaker_layout_changed', function() {\n\t\t\t\tblockPositions = $('.block-position').addClass('block-receiver').sortable(sortableOptions);\n\t\t\t});\n\n\t\t\t$('#toggle-edit').button();\n\t\t\tsaveBtn = $('#save-changes').button({disabled: true}).click(function(e) {\n\t\t\t\t// save changes\n\t\t\t\te.preventDefault();\n\t\t\t\tsaveLayout();\n\t\t\t});\n\n\t\t\t$('.has-dropdown').click(function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\t$(this).parentsUntil('ul').parent().find('.dropped').not($(this)).removeClass('dropped').next().hide();\n\t\t\t\tblocksPanel = $(this).toggleClass('dropped');\n\t\t\t\tblocksPanel.next().toggle();\n\t\t\t});\n\n\t\t\t$('#admin-options').show(100, function() {\n\t\t\t\tvar exPos = exPositions.val();\n\t\t\t\tif (exPos) {\n\t\t\t\t\tshowCurrentState(isHidingBlocks, exPos);\n\t\t\t\t}\n\n\t\t\t\t// Thanks KungFuJosh, for this tip\n\t\t\t\tbody = $('body').addClass('push-down');\n\t\t\t});\n\n\t\t\t// Only show style selector if there are other styles\n\t\t\tvar styleSelector = $('#style-options');\n\t\t\tif (styleSelector.find('option').length > 1) {\n\t\t\t\tstyleSelector.show();\n\t\t\t}\n\n\t\t\t$.ajaxSetup({\n\t\t\t\t// add style and session ids to ajax requests\n\t\t\t\t'beforeSend': function(xhr, settings) {\n\t\t\t\t\tloader.addClass('fa-spinner fa-green fa-spin fa-lg fa-pulse');\n\t\t\t\t\tsettings.url += ((settings.url.indexOf('?') < 0) ? '?' : '&') + 'style=' + config.style;\n\t\t\t\t},\n\t\t\t\t'complete': function(data) {\n\t\t\t\t\tloader.delay(2000).removeClass('fa-spinner fa-green fa-spin fa-lg fa-pulse');\n\n\t\t\t\t\tif (data.responseJSON) {\n\t\t\t\t\t\t// Display any returned message\n\t\t\t\t\t\tif (data.responseJSON.message) {\n\t\t\t\t\t\t\tshowMessage(data.responseJSON.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t'error': function(event) {\n\t\t\t\t\tshowMessage((event.responseJSON && event.responseJSON.message) ? event.responseJSON.message : lang.ajaxError);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teButtons[lang.edit] = function() {\n\t\t\t\tsaveForm(blockObj);\n\t\t\t};\n\n\t\t\teButtons[lang.cancel] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\tdButtons[lang.remove] = function() {\n\t\t\t\tvar horizontalPos = blockObj.parent('.horizontal');\n\n\t\t\t\tblockObj.remove();\n\t\t\t\thorizontalPos.find('.ui-effects-placeholder').remove();\n\n\t\t\t\tvar items = horizontalPos.find('.block');\n\n\t\t\t\tif (items.length > 0) {\n\t\t\t\t\tsortHorizontal(items);\n\t\t\t\t}\n\n\t\t\t\thideEmptyPositions();\n\t\t\t\tsaveBtn.button('enable');\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\tdButtons[lang.cancel] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\tvar defDialog = {\n\t\t\t\tautoOpen: false,\n\t\t\t\tmodal: true,\n\t\t\t\twidth: 'auto',\n\t\t\t\tshow: 'slide',\n\t\t\t\thide: 'slide'\n\t\t\t};\n\n\t\t\tdialogConfirm = $('#dialog-confirm').dialog(defDialog);\n\n\t\t\t// Delete all blocks\n\t\t\tlButtons[lang.deleteAll] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t\t$('.block-position').empty();\n\t\t\t\thideEmptyPositions();\n\t\t\t\tsaveBtn.button('enable');\n\t\t\t\tupdated = true;\n\t\t\t};\n\n\t\t\tlButtons[lang.cancel] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\tvar dialogDeleteAll = $('#dialog-delete-all').dialog(defDialog);\n\t\t\tvar deleteAll = $('#delete-blocks').button().click(function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tdialogDeleteAll.dialog({buttons: lButtons}).dialog('open');\n\t\t\t});\n\n\t\t\t// Initiate dialog for block copy\n\t\t\tcButtons[lang.copy] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t\tcopyBlocks(copyFrom);\n\t\t\t\tdeleteAll.parent().show();\n\t\t\t};\n\n\t\t\tcButtons[lang.cancel] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\t// Events for add block dropdown\n\t\t\tdialogCopy = $('#dialog-copy').dialog(defDialog);\n\t\t\t$('#copy-form').find('.layout-action').button().click(function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tcopyFrom = $(this).parent().parent().serializeArray();\n\n\t\t\t\tvar fromRoute = copyFrom[0].value;\n\t\t\t\tvar fromStyle = copyFrom[1].value;\n\t\t\t\tvar layoutAction = $(this).data('action');\n\n\t\t\t\tif (fromRoute === '' || (fromRoute === config.route && fromStyle === config.style)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (layoutAction === 'copy') {\n\t\t\t\t\tblocksPanel.trigger('click');\n\t\t\t\t\tdialogCopy.dialog({buttons: cButtons}).dialog('open');\n\t\t\t\t} else {\n\t\t\t\t\tvar url = config.boardUrl + '/';\n\t\t\t\t\turl += (config.modReWrite) ? fromRoute.replace('app.php/', '') : fromRoute;\n\t\t\t\t\turl += ((url.indexOf('?') >= 0) ? '&' : '?') + 'style=' + fromStyle;\n\n\t\t\t\t\twindow.location.href = url;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Events for edit block dialog\n\t\t\tdefDialog.open = function() {\n\t\t\t\tif (dialogEditOpened === false) {\n\t\t\t\t\tvar pane = $(this).dialog('widget').find('.ui-dialog-buttonpane');\n\t\t\t\t\tdialogEditOpened = true;\n\t\t\t\t\t$('<label class=\"dialog-check-button\"><input id=\"update-similar\" type=\"checkbox\" /> ' + lang.updateSimilar + '</label>').prependTo(pane);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tdefDialog.beforeClose = function() {\n\t\t\t\tundoPreviewBlock();\n\t\t\t};\n\n\t\t\tdialogEdit = $('#dialog-edit').dialog(defDialog).on('click', '.block-class-actions', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tvar action = $(this).data('action');\n\t\t\t\tvar editor = dialogEdit.find('#block_class');\n\t\t\t\tswitch (action) {\n\t\t\t\t\tcase 'clear':\n\t\t\t\t\t\teditor.text('').change();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'toggle':\n\t\t\t\t\t\tvar target = $(this).attr('href');\n\t\t\t\t\t\tdialogEdit.find(target).slideToggle();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'undo':\n\t\t\t\t\tcase 'redo':\n\t\t\t\t\t\teditor.focus();\n\t\t\t\t\t\tdocument.execCommand(action, false, null);\n\t\t\t\t\t\teditor.change();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}).on('click', '.class-cat', function(e) {\n\t\t\t\tvar id = $(this).attr('href');\n\t\t\t\tvar obj = $('#classes-scroller');\n\t\t\t\tobj.animate({\n\t\t\t\t\tscrollTop: obj.scrollTop() + $(id).position().top\n\t\t\t\t}, 1000);\n\t\t\t\te.preventDefault();\n\t\t\t}).on('click', '.transform', function(e) {\n\t\t\t\tvar editor = dialogEdit.find('#block_class');\n\t\t\t\teditor.focus();\n\t\t\t\tdocument.execCommand('insertText', false, $(this).text() + ' ');\n\t\t\t\teditor.change();\n\t\t\t\te.preventDefault();\n\t\t\t}).on('change', '.block-preview', function() {\n\t\t\t\tpreviewBlock();\n\t\t\t});\n\n\t\t\t// Set default layout\n\t\t\t$('.default-layout').button().click(function(e) {\n\t\t\t\tvar setDefault = $(this).data('set');\n\t\t\t\tsetDefaultLayout(setDefault);\n\t\t\t\te.preventDefault();\n\t\t\t\tif (setDefault === true) {\n\t\t\t\t\t// set as default\n\t\t\t\t\t$(this).parent().hide().next().hide().next().show();\n\t\t\t\t\tdeleteAll.parent().hide();\n\t\t\t\t} else {\n\t\t\t\t\t// remove as default\n\t\t\t\t\t$(this).parent().hide().prev().hide().prev().show();\n\t\t\t\t\tdeleteAll.parent().show();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Set start page\n\t\t\t$('.sm-startpage').button().click(function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tvar info = {};\n\t\t\t\tif ($(this).attr('id') === 'set-startpage') {\n\t\t\t\t\t// set as startpage\n\t\t\t\t\t$(this).parent().hide().next().show();\n\t\t\t\t\tinfo = {\n\t\t\t\t\t\tcontroller: $(this).data('controller'),\n\t\t\t\t\t\tmethod: $(this).data('method'),\n\t\t\t\t\t\tparams: $(this).data('params')\n\t\t\t\t\t};\n\t\t\t\t\tsetStartPage(info);\n\t\t\t\t} else {\n\t\t\t\t\t// remove as startpage\n\t\t\t\t\t$(this).parent().hide().prev().show();\n\t\t\t\t\tsetStartPage(info);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tisHidingBlocks = $('#route-settings').submit(function(e) {\n\t\t\t\tsetRoutePrefs($(this), exPositions.val());\n\t\t\t\te.preventDefault();\n\t\t\t}).find('#hide_blocks').is(':checked');\n\n\t\t\twindow.onbeforeunload = function(e) {\n\t\t\t\tif (updated === true) {\n\t\t\t\t\te = e || window.event;\n\t\t\t\t\t// For IE and Firefox\n\t\t\t\t\tif (e) {\n\t\t\t\t\t\te.returnValue = lang.leaveConfirm;\n\t\t\t\t\t}\n\t\t\t\t\t// For Safari\n\t\t\t\t\treturn lang.leaveConfirm;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Init Icon Picker\n\t\t\t$('.sitemaker').iconPicker({\n\t\t\t\tselector: '.block-icon',\n\t\t\t\tonSelect: function(item, iconClass) {\n\t\t\t\t\tvar id = item.parentsUntil('.block').parent().attr('id').substring(6);\n\t\t\t\t\tupdateBlock({'id': id, 'icon': iconClass});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tinitTinyMce();\n\t\t}\n\t});\n})(jQuery, window, document);"]}