{"version":3,"sources":["menu/admin.min.js"],"names":["$","window","document","undefined","codeMirror","insertText","data","doc","getDoc","cursor","getCursor","line","getLine","pos","match","replaceRange","ready","ajaxUrl","menuId","lang","Twig","dButtons","menuAdmin","dialogConfirmDelete","currentMenuTitle","extendFunction","value","ajaxSend","event","xhr","settings","url","indexOf","iconPicker","selector","onSelect","item","iconClass","id","parentsUntil","parent","attr","substring","treeBuilder","item_icon","menuDivObj","on","e","this","children","removeClass","addClass","preventDefault","element","prev","find","text","inlineMenuForm","show","appendTo","val","focus","select","end","dialog","buttons","hide","editForm","dialogEdit","dialogConfirm","click","slideToggle","button","getJSON","html","title","edit","remove","append","submit","trigger","focusout","menuTitle","post","menu","name","resp","up","down","next","length","location","reload","cancel","autoOpen","modal","width","trim","each","i","list","items","split","j","parts","push","replace","siblings","join","bulkTypeItems","parents","toggle","icons","primary","$button","currentTarget","$dropdown","offset","height","top","left","buttonset","cmTabs","cm","matches","change","spaces","options","tabSize","operation","from","CodeMirror","changeEnd","indentLine","jQuery"],"mappings":"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","file":"admin.min.js","sourcesContent":[";(function($, window, document, undefined) {\n\t'use strict';\n\n\tvar codeMirror = {};\n\n\tfunction insertText(data) {\n\t\tvar doc = codeMirror.getDoc();\n\t\tvar cursor = doc.getCursor();\n\t\tvar line = doc.getLine(cursor.line);\n\t\tvar pos = {\n\t\t\tline: cursor.line\n\t\t};\n\n\t\tif (!line.match(/\\S/i)) {\n\t\t\tdoc.replaceRange(data, pos);\n\t\t} else {\n\t\t\tdoc.replaceRange(\"\\n\" + data, pos);\n\t\t}\n\t}\n\n\t$(document).ready(function() {\n\t\tvar ajaxUrl = window.ajaxUrl || '';\n\t\tvar menuId = window.menuId || 0;\n\t\tvar lang = window.lang || {};\n\t\tvar Twig = window.Twig || {};\n\n\t\tvar dButtons = {};\n\t\tvar menuAdmin = {};\n\t\tvar dialogConfirmDelete = {};\n\t\tvar currentMenuTitle = '';\n\n\t\tTwig.extendFunction('lang', function(value) {\n\t\t\treturn (typeof lang[value] !== 'undefined') ? lang[value] : value;\n\t\t});\n\n\t\t// add menu id to ajax requests\n\t\t$(document).ajaxSend(function(event, xhr, settings) {\n\t\t\tsettings.url += (settings.url.indexOf('?') >= 0) ? '&' : '?';\n\t\t\tsettings.url += 'menu_id=' + menuId;\n\t\t});\n\n\t\t// Init icon picker\n\t\t$('.items-list').iconPicker({\n\t\t\tselector: '.icon-select',\n\t\t\tonSelect: function(item, iconClass) {\n\t\t\t\tvar id = item.parentsUntil('li').parent().attr('id').substring(5);\n\t\t\t\tmenuAdmin.treeBuilder('updateItem', {'item_icon': iconClass}, id);\n\t\t\t}\n\t\t});\n\n\t\t// menu list\n\t\tvar menuDivObj = $('#sm-menus')\n\t\t\t.on('click', '.menu-option', function(e) {\n\t\t\t\tmenuId = +$(this).parent().attr('id').substring(5);\n\t\t\t\t$(this).parent().parent().children().removeClass('row3 current-menu');\n\t\t\t\t$(this).parent().addClass('row3 current-menu');\n\t\t\t\tmenuAdmin.treeBuilder('getItems');\n\t\t\t\te.preventDefault();\n\t\t\t})\n\t\t\t.on('click', '.menu-edit', function(e) {\n\t\t\t\tvar element = $(this).parent().prev().removeClass('menu-option').parent().removeClass('current-menu').find('.menu-editable');\n\t\t\t\tcurrentMenuTitle = element.text();\n\t\t\t\tinlineMenuForm.show().appendTo(element.text('')).children(':input').val(currentMenuTitle).focus().select().end();\n\t\t\t\te.preventDefault();\n\t\t\t})\n\t\t\t.on('click', '.menu-delete', function(e) {\n\t\t\t\tdialogConfirmDelete.dialog({buttons: dButtons}).dialog('open');\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\tvar inlineMenuForm = $('<form id=\"inline-menu-form\"><input type=\"text\" id=\"inline-menu-edit\" value=\"\" /></form>').hide().appendTo($('body'));\n\n\t\t// manage menu items\n\t\tmenuAdmin = $('#nested-tree').treeBuilder({\n\t\t\tajaxUrl: ajaxUrl,\n\t\t\teditForm: '#edit-menu-item-form',\n\t\t\tdialogEdit: '#dialog-edit-menu-item',\n\t\t\tdialogConfirm: '#dialog-confirm-menu-item'\n\t\t});\n\n\t\t$('.toggle-view').click(function(e) {\n\t\t\t$($(this).attr('href')).slideToggle();\n\t\t\te.preventDefault();\n\t\t});\n\n\t\t// add new menu\n\t\t$('#add-menu').button().click(function(e) {\n\t\t\tmenuId = 0;\n\t\t\t$.getJSON(ajaxUrl + 'add_menu', function(data) {\n\t\t\t\tif (data.id === null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tmenuId = data.id;\n\n\t\t\t\tvar html = '<li id=\"menu-' + menuId + '\" class=\"row3 current-menu\">';\n\t\t\t\thtml += '<a href=\"#\" class=\"menu-option\"><span class=\"menu-editable\">' + data.title + '</span></a>';\n\t\t\t\thtml += '<div class=\"menu-actions\">';\n\t\t\t\thtml += '<a href=\"#\" class=\"menu-edit left\" title=\"' + lang.edit + '\"><span class=\"ui-icon ui-icon-gear\"></span></a>';\n\t\t\t\thtml += '<a href=\"#\" class=\"menu-delete left\" title=\"' + lang.remove + '\"><span class=\"ui-icon ui-icon-trash\"></span></a>';\n\t\t\t\thtml += '</span></li>';\n\t\t\t\tmenuDivObj.children('li').removeClass('row3 current-menu');\n\t\t\t\tmenuDivObj.append(html);\n\n\t\t\t\tmenuAdmin.show().treeBuilder('getItems');\n\t\t\t});\n\n\t\t\te.preventDefault();\n\t\t});\n\n\t\t$('#inline-menu-form').submit(function(e) {\n\t\t\te.preventDefault();\n\t\t\t$(this).children('#inline-menu-edit').trigger('blur');\n\t\t});\n\n\t\t$('#inline-menu-edit').focusout(function(e) {\n\t\t\tvar menuTitle = $(this).val();\n\t\t\tvar element = $(this).val('').parent().parent();\n\n\t\t\tif (menuId && menuTitle && menuTitle !== currentMenuTitle) {\n\t\t\t\t$.post(ajaxUrl + 'edit_menu', {'title': menuTitle}, function(menu) {\n\t\t\t\t\tif (menu.name) {\n\t\t\t\t\t\telement.text(menu.name);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tmenuTitle = currentMenuTitle;\n\t\t\t}\n\n\t\t\tinlineMenuForm.hide().appendTo($('body'));\n\t\t\telement.text(menuTitle).parent().addClass('menu-option').parent().addClass('current-menu');\n\t\t\te.preventDefault();\n\t\t});\n\n\t\tdButtons[lang.remove] = function() {\n\t\t\tif (menuId) {\n\t\t\t\t$.getJSON(ajaxUrl + 'delete_menu', function(resp) {\n\t\t\t\t\tif (resp.id === menuId) {\n\t\t\t\t\t\tvar menu = $('#menu-' + menuId);\n\t\t\t\t\t\tvar up = menu.prev();\n\t\t\t\t\t\tvar down = menu.next();\n\n\t\t\t\t\t\tif (up.length) {\n\t\t\t\t\t\t\tup.find('.menu-option').trigger('click');\n\t\t\t\t\t\t} else if (down.length) {\n\t\t\t\t\t\t\tdown.find('.menu-option').trigger('click');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twindow.location.reload(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmenu.remove();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t$(this).dialog('close');\n\t\t};\n\n\t\tdButtons[lang.cancel] = function() {\n\t\t\t$(this).dialog('close');\n\t\t};\n\n\t\tdialogConfirmDelete = $('#dialog-confirm-menu').dialog({\n\t\t\tautoOpen: false,\n\t\t\tmodal: true,\n\t\t\twidth: 'auto',\n\t\t\tshow: 'slide',\n\t\t\thide: 'slide'\n\t\t});\n\n\t\tif (menuId) {\n\t\t\tmenuAdmin.show();\n\t\t}\n\n\t\tcodeMirror = $('#nested-tree').treeBuilder('getCodeMirrorInstance');\n\n\t\t// set button events\n\t\t$('.bulk-type').button().click(function(e) {\n\t\t\te.preventDefault();\n\t\t\tvar itemsStr = $(this).data('items').trim();\n\t\t\tinsertText(itemsStr);\n\t\t}).each(function(i, element) {\n\t\t\tvar list = [];\n\t\t\tvar items = $(this).data('items').trim().split(\"\\n\");\n\t\t\t$.each(items, function(j, item) {\n\t\t\t\tvar parts = item.split('|');\n\t\t\t\tlist.push('<a href=\"#\" data-item=\"' + item + '\">' + parts[0].replace(/\\t/g, '&nbsp; &nbsp;') + '</a>');\n\t\t\t});\n\t\t\t$(element).siblings('.bulk-dropdown').children('.inner').html(list.join('<br />'));\n\t\t});\n\n\t\tvar bulkTypeItems = $('.bulk-type-items').on('click', 'a', function(e) {\n\t\t\te.preventDefault();\n\t\t\tinsertText($(this).data('item').trim());\n\t\t\t$(this).parents('.bulk-type-items').toggle();\n\t\t});\n\n\t\t$('.bulk-type-list').button({\n\t\t\ttext: false,\n\t\t\ticons: {\n\t\t\t\tprimary: 'ui-icon-triangle-1-n'\n\t\t\t}\n\t\t}).click(function(e) {\n\t\t\te.preventDefault();\n\t\t\tbulkTypeItems.hide();\n\n\t\t\tvar $button = $(e.currentTarget);\n\t\t\tvar $dropdown = $button.next();\n\t\t\tvar pos = $button.offset();\n\t\t\tvar height = $dropdown.height();\n\t\t\tvar width = $dropdown.width();\n\n\t\t\t$dropdown.toggle().offset({\n\t\t\t\ttop: pos.top - height,\n\t\t\t\tleft: pos.left - (width / 2) - $button.width()\n\t\t\t});\n\t\t}).parent().buttonset();\n\n\t\tvar cmTabs = 0;\n\t\tcodeMirror.on(\"keyup\", function(cm) {\n\t\t\tvar doc = cm.getDoc();\n\t\t\tvar line = doc.getLine(cm.getCursor().line);\n\t\t\tvar matches = line.match(/\\s/gim);\n\t\t\tcmTabs = matches ? matches.length : 0;\n\t\t});\n\n\t\tcodeMirror.on(\"change\", function(cm, change) {\n\t\t    var spaces = cmTabs * cm.options.tabSize;\n\t\t    cm.operation(function() {\n\t\t    \t/* global CodeMirror */\n\t\t        for (var line = change.from.line + 1, end = CodeMirror.changeEnd(change).line; line <= end; ++line) {\n\t\t            cm.indentLine(line, spaces);\n\t\t        }\n\t\t    });\n\t\t});\n\t});\n})(jQuery, window, document);"]}